<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e909ca77e15e07f0bc8a.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400);code[class*=language-],pre[class*=language-]{color:#fff;background:none;text-shadow:0 -.1em .2em #000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#4d4033}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:.3em solid #7a6652;border-radius:.5em;box-shadow:inset 1px 1px .5em #000}:not(pre)>code[class*=language-]{padding:.15em .2em .05em;border-radius:.3em;border:.13em solid #7a6652;box-shadow:inset 1px 1px .3em -.1em #000;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998066}.token.namespace,.token.punctuation{opacity:.7}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#d1949e}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#bde052}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f5b83d}.token.atrule,.token.attr-value,.token.keyword{color:#d1949e}.token.important,.token.regex{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.deleted{color:red}.course{position:relative;width:100%}@media (min-width:992px){.course{display:flex;flex-wrap:nowrap;flex-direction:row;align-items:flex-start}}.course p{font-family:IBM Plex Sans,monospace}@media (min-width:640px){.course p{margin-left:1rem}}.course p:not(:last-of-type){margin-bottom:1rem}@media (min-width:640px){.course h1{margin-left:3rem}}.course h2,.course h3,.course h4{padding-bottom:2rem}@media (min-width:640px){.course h2,.course h3,.course h4,.course table{margin-left:1rem}}.course ul{font-family:IBM Plex Sans,monospace}@media (min-width:640px){.course ul{margin-left:2.2rem}}.course h2:not(:first-of-type){margin-top:2rem}.course pre{margin:2rem 0;background-color:#33332d;color:#fff}.course em{font-family:Courier;font-style:normal;background-color:hsla(0,0%,88.2%,.6);padding:1px 5px 2px}.course img{border:11px solid transparent}.course .banner,.course .container{position:static}.course .letter{width:4rem;height:4rem;border-width:5px;border-style:solid;border-radius:2.5rem;text-align:center;margin:1rem;line-height:1.3em;transform:translate(-1rem)}@media (min-width:640px){.course .letter{transform:translate(-3rem,4.5rem)}}.course .letter,.course h1{font-size:2.3rem;font-weight:700}.course-content-container{width:100%}.course-content a,.tasks a{border:0;border-bottom-width:2px;border-style:solid;padding:2px}.course-content{width:90%;margin:0 auto;max-width:1200px}@media (min-width:992px){.course-content-inner{padding-left:30%;padding-right:5%}}.tasks a{border-color:#33332d!important}.tasks a:hover{background-color:#fff!important;color:#000!important}.gatsby-highlight-code-line{background-color:hsla(0,0%,88.2%,.3);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:1em}code[class*=language-],pre[class*=language-]{text-shadow:none}.arrow-go-up{width:36px;height:36px;position:fixed;bottom:5%;right:5%;z-index:99999;cursor:pointer}@media (max-width:639px){.arrow-go-up{right:10%}}.part-main__banner{background-position:50%;background-size:50%;padding-bottom:10%;background-repeat:no-repeat}@media (max-width:639px){.part-main__banner{background-position:top;background-size:70%;padding-bottom:30%!important}}.part-intro{font-family:IBM Plex Sans,monospace!important}.part-intro p:not(:last-of-type){padding-bottom:2em}.part-intro__banner{background-size:50%;background-repeat:no-repeat;background-position:100%}@media (max-width:639px){.part-intro__banner{background-position:top;background-size:70%}.part-intro__banner>.container{margin-top:40%}}.part-intro a{border-bottom:1px solid #33332d}.part-intro a:hover{background-color:#fff}.arrow__container{position:relative}.arrow__container:not():first-child{background:none;background-color:none}@media (min-width:640px){.arrow__container:not():first-child{border-left:none}.arrow__container:not():first-child:before{content:"";background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/PjwhLS1HZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCktLT48c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA0NzcuMTc1IDQ3Ny4xNzUiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ3Ny4xNzUgNDc3LjE3NSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGc+PHBhdGggZD0iTTM2MC43MzEsMjI5LjA3NWwtMjI1LjEtMjI1LjFjLTUuMy01LjMtMTMuOC01LjMtMTkuMSwwcy01LjMsMTMuOCwwLDE5LjFsMjE1LjUsMjE1LjVsLTIxNS41LDIxNS41CgkJYy01LjMsNS4zLTUuMywxMy44LDAsMTkuMWMyLjYsMi42LDYuMSw0LDkuNSw0YzMuNCwwLDYuOS0xLjMsOS41LTRsMjI1LjEtMjI1LjFDMzY1LjkzMSwyNDIuODc1LDM2NS45MzEsMjM0LjI3NSwzNjAuNzMxLDIyOS4wNzV6CgkJIi8+PC9nPjxnLz48Zy8+PGcvPjxnLz48Zy8+PGcvPjxnLz48Zy8+PGcvPjxnLz48Zy8+PGcvPjxnLz48Zy8+PGcvPjwvc3ZnPg==) no-repeat;background-size:contain;position:absolute;top:0;left:0;height:100%;width:100%}}.arrows--horizontal{display:flex;position:relative;margin:0;align-items:flex-start}.arrow__wrapper{display:flex;justify-content:flex-start;align-items:center;margin:0}.arrow__wrapper:first-of-type{border-right:none;z-index:20}.arrow__wrapper:nth-of-type(n+2){margin-left:-4rem;z-index:10}.arrow__wrapper:nth-of-type(n+2) .arrow__rectangle{border-left:none;padding-left:4rem}.arrow__wrapper:nth-of-type(3){z-index:5}.arrow__wrapper:hover .arrow__point,.arrow__wrapper:hover .arrow__rectangle,.arrow__wrapper:hover .arrow__rectangle>a{background-color:#33332d!important;color:#fff!important}.arrow__rectangle{padding:1rem;justify-content:center;align-items:center;border:2px solid #33332d;border-right:none;z-index:2;overflow:hidden;font-family:IBM Plex Sans,monospace;position:relative}@media (max-width:991px){.arrow__rectangle{font-size:1rem}}.arrow__rectangle .bold{font-weight:600}.arrow__rectangle--thick-border{border:3px solid #33332d;border-right:none}.arrow__point{padding:1.25rem;border:2px solid #33332d;border-bottom:none;border-left:none;transform:translate(-1.3rem) rotate(45deg);z-index:1;overflow:hidden}.arrow__point--thick-border{border:3px solid #33332d;border-bottom:none;border-left:none}.arrow__wrapper--stacked{display:flex;justify-content:flex-start;align-items:center;margin:auto auto auto 0}@media (max-width:639px){.arrow__wrapper--stacked .arrow__rectangle{border:none;background-color:transparent!important;padding:0;font-size:1rem;justify-content:unset}.arrow__wrapper--stacked .arrow__rectangle>p>span{border-bottom:1px solid #33332d;margin:auto}.arrow__wrapper--stacked .arrow__rectangle>p>span:hover{background-color:#fff!important;color:#000}.arrow__wrapper--stacked .arrow__point{display:none}}.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:1rem}@media (min-width:640px){.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:-2px}}.arrow__wrapper--stacked .arrow__rectangle{position:relative}@media (min-width:640px){.arrow__wrapper--stacked .arrow__rectangle{padding:1.25rem}}@media (min-width:992px){.arrow__wrapper--stacked .arrow__rectangle{padding:1rem}}.arrow__wrapper--stacked .arrow__point{padding:1.08rem;margin-left:2px}@media (min-width:640px){.arrow__wrapper--stacked .arrow__point{margin-left:unset;padding:1.25rem}}@media (min-width:640px){.arrow__wrapper--stacked:hover .arrow__point,.arrow__wrapper--stacked:hover .arrow__rectangle{background-color:#33332d!important}}@media (min-width:640px){.arrow__wrapper--stacked:hover .arrow--stacked-letter,.arrow__wrapper--stacked:hover .arrow--stacked-title{color:#fff}}.arrow--stacked-title{font-family:IBM Plex Mono,monospace}@media (min-width:640px){.arrow--stacked-title{white-space:nowrap}}.arrow__container--with-link{width:100%!important}@media (max-width:639px){.breadcrumb .arrow__wrapper{display:none}}.breadcrumb .arrow__wrapper:hover .arrow__point,.breadcrumb .arrow__wrapper:hover .arrow__rectangle{background-color:#33332d!important}.breadcrumb .arrow__wrapper:hover .arrow--stacked-letter,.breadcrumb .arrow__wrapper:hover .arrow--stacked-title{color:#fff}.breadcrumb .arrow__rectangle{position:relative}@media (max-width:639px){.breadcrumb .arrow__rectangle{border:none;padding:0;font-size:.7rem;white-space:nowrap;background-color:transparent!important;color:#33332d}}@media (max-width:639px){.breadcrumb .arrow__point{display:none}}.banner{display:flex;width:100%;align-items:center;position:relative;padding:2rem 0;background-color:#e1e1e1}@media (min-width:992px){.banner{padding:3.444rem 3.444rem 4.444rem}}html{font-family:IBM Plex Mono,monospace;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:IBM Plex Mono,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em IBM Plex Mono,monospace;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:IBM Plex Mono,monospace;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{margin:2rem 0 -.5rem;font-size:1.38316rem}h3,h4{padding:0;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{margin:2rem 0 -1rem;font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.element--flex{display:flex;flex-wrap:wrap}.element--space-around{justify-content:space-around}.element--space-between{justify-content:space-between}.element--column{flex-direction:column}.element--centered{align-items:center;justify-content:center!important}@media (min-width:992px){.element--centered-in-desktop{align-items:center;justify-content:center!important}}@media (min-width:992px){.element--horizontal-half{width:45%}}.element--auto-margin{margin:auto}.element--auto-bottom-margin{margin-bottom:auto}.element--flex-start{align-content:flex-start}.element--no-wrap{flex-wrap:nowrap}.element--relative{position:relative!important}.edit-link>span{border-bottom-width:3px;border-bottom-style:solid;border-bottom-color:inherit}.accordion__container{margin-bottom:1rem}.accordion__title{padding-left:2.149rem!important;padding-right:2.149rem!important;font-size:1.111rem!important;font-weight:600}.accordion{background-color:#fff;border:3px solid #33332d;border-radius:5px;color:#444;cursor:pointer;padding:1rem;width:100%;text-align:left;outline:none;font-size:15px;transition:max-width .4s}.accordion:hover,.active{background-color:#e1e1e1}.accordion:after{content:"+";font-size:1.5rem;float:right;margin-left:5px}.active{border-color:#fff}.active:after{content:"-";font-size:1.5rem}.panel{background-color:#fff;transition:height .3s;transition-timing-function:ease-in-out;overflow:hidden}.accordion--side-navigation{width:100%;margin-left:unset}.accordion--side-navigation .accordion{border:none;padding:0!important;background-color:transparent!important;color:#33332d!important;border-radius:0}.accordion--side-navigation .accordion__title{font-size:16px!important;font-weight:unset;background-color:transparent}.accordion--side-navigation .accordion__title:hover{background-color:#33332d!important;color:#fff!important}.accordion--side-navigation .panel{padding:1rem 0 0!important;background-color:transparent}.accordion--side-navigation .panel ul{margin-left:1rem}.accordion--side-navigation .accordion:hover,.accordion--side-navigation .active{background-color:#33332d;color:#fff}.accordion--side-navigation .accordion:after,.accordion--side-navigation .active:after{content:""}.body-text:not(:last-of-type){margin-bottom:2.5rem}.body-text__title{color:#33332d;font-size:1.44rem;line-height:1.25em;font-weight:700;margin:0;position:relative;top:50%;transform:translateY(-50%)}.body-text__content:not(:last-of-type){padding-bottom:2em}.bold{font-weight:700}.body-text--no-padding{padding:0!important}@media (min-width:640px){.companies__main-title .body-text__title{font-size:3rem}}.challenge-title{font-size:1.44rem}@media (min-width:992px){.company__logo{width:15%!important}}.content-liftup{position:relative;text-decoration:none}.content-liftup--small{box-sizing:border-box}.content-liftup--small>:last-child{margin-bottom:0}.content-liftup__name{margin-top:1.5rem;color:#33332d;font-weight:700}@media (min-width:992px){.content-liftup__name{margin-top:2rem}}.content-liftup__summary{margin-top:1rem;margin-bottom:3rem;color:#33332d;line-height:28px}.content-liftup__link{text-decoration:none;font-weight:700}.content-liftup .content-liftup__image:after,.content-liftup__link:after{content:"";position:absolute;top:0;left:0;height:100%;width:100%}.content-liftup .content-liftup__image:after{opacity:.5;z-index:2}body,html{margin:0;padding:0;font-family:IBM Plex Mono,monospace;font-weight:500;color:#33332d;font-size:14px;line-height:1.555rem}@media (min-width:992px){body,html{font-size:18px}}.main-wrapper{min-height:100vh;display:flex;flex-direction:column}p{margin:0;text-align:left;line-height:1.5em}a,p{color:#33332d}a{text-decoration:none}.link a{border-bottom:2px solid #e1e1e1}.link a:hover{background-color:#e1e1e1}.container{position:relative;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;width:90%;max-width:1300px}@media (max-width:639px){.container{padding:0 20px}}@media (min-width:992px){.container--right{margin-right:5%;width:54%;max-width:779.9844px}}@media (min-width:992px) and (min-width:1300px){.container--right{margin-right:calc((100% - 1300px)/2)}}.hidden{display:none!important}.centered{text-align:center}@media (max-width:639px){.centered--mobile{justify-content:center;align-content:center;align-items:center}}.spacing{margin-top:2rem}@media (max-width:992px) and (min-width:640px){.spacing--tablet{margin-top:5rem!important}}@media (min-width:992px){.spacing{margin-top:5rem}}.spacing--small{margin-top:1rem}@media (min-width:992px){.spacing--small{margin-top:3.444rem}}.spacing--large{margin-top:4rem}@media (min-width:992px){.spacing--large{margin-top:10rem}}.spacing--extra-large{margin-top:4rem}@media (min-width:992px){.spacing--extra-large{margin-top:20rem}}.spacing--after{margin-bottom:2rem}@media (min-width:992px){.spacing--after{margin-bottom:5rem}}@media (max-width:639px){.spacing--after--mobile{margin-bottom:5rem}}@media (min-width:992px){.spacing--after-small{margin-bottom:2.5rem}}.spacing--after-large{margin-bottom:4rem}@media (min-width:992px){.spacing--after-large{margin-bottom:10rem}}@media (max-width:991px){.spacing--mobile{margin-top:2rem}}@media (max-width:1299px){.spacing--mobile--small{margin-top:1.5rem}}@media (max-width:1299px){.spacing--mobile--large{margin-top:3rem}}.col-1{width:100%}@media (min-width:992px){.col-1{width:10%}}.col-2{width:100%}@media (min-width:992px){.col-2{width:20%}}.col-3{width:100%}@media (min-width:992px){.col-3{width:30%}}.col-4{width:100%}@media (min-width:992px){.col-4{width:40%}}.col-5{width:100%}@media (min-width:992px){.col-5{width:50%}}.col-6{width:100%}@media (min-width:992px){.col-6{width:60%}}.col-7{width:100%}@media (min-width:992px){.col-7{width:70%}}.col-8{width:100%}@media (min-width:992px){.col-8{width:80%}}.col-9{width:100%}@media (min-width:992px){.col-9{width:90%}}.col-10{width:100%}@media (min-width:992px){.col-10{width:100%}}@media (min-width:992px){.push-right-1{margin-left:10%}.push-right-2{margin-left:20%}.push-right-3{margin-left:30%}.push-right-4{margin-left:40%}.push-right-5{margin-left:50%}.push-left-1{margin-right:10%}.push-left-2{margin-right:20%}.push-left-3{margin-right:30%}.push-left-4{margin-right:40%}.push-left-5{margin-right:50%}.push-left{margin-right:auto}.push-right{margin-left:auto}}@media (max-width:639px){.col-1--mobile{width:10%!important}.col-2--mobile{width:20%!important}.col-3--mobile{width:30%!important}.col-4--mobile{width:40%!important}.col-5--mobile{width:50%!important}.col-6--mobile{width:60%!important}.col-7--mobile{width:70%!important}.col-8--mobile{width:80%!important}.col-9--mobile{width:90%!important}.col-10--mobile{width:100%!important}.push-right-1--mobile{margin-left:10%!important}.push-right-2--mobile{margin-left:20%!important}.push-right-3--mobile{margin-left:30%!important}.push-right-4--mobile{margin-left:40%!important}.push-right-5--mobile{margin-left:50%!important}.push-left-1--mobile{margin-right:10%!important}.push-left-2--mobile{margin-right:20%!important}.push-left-3--mobile{margin-right:30%!important}.push-left-4--mobile{margin-right:40%!important}.push-left-5--mobile{margin-right:50%!important}.order-0--mobile{order:0}.order-1--mobile{order:1}.order-2--mobile{order:2}.order-3--mobile{order:3}.order-4--mobile{order:4}.order-5--mobile{order:5}.hidden--mobile{display:none}}@media (max-width:1299px){.col-1--tablet{width:10%}.col-2--tablet{width:20%}.col-3--tablet{width:30%}.col-4--tablet{width:40%}.col-5--tablet{width:50%}.col-6--tablet{width:60%}.col-7--tablet{width:70%}.col-8--tablet{width:80%}.col-9--tablet{width:90%}.col-10--tablet{width:100%}.order-0--tablet{order:0}.order-1--tablet{order:1}.order-2--tablet{order:2}.order-3--tablet{order:3}.order-4--tablet{order:4}.order-5--tablet{order:5}.order-0--mobile{order:0}.order-1--mobile{order:1}.order-2--mobile{order:2}.order-3--mobile{order:3}.order-4--mobile{order:4}.order-5--mobile{order:5}.hidden--mobile{display:none}}.centered-vertically{display:flex;flex-direction:column;justify-content:center}.nav-item-hover{text-decoration:none;color:#33332d;font-weight:500;padding:.2em}@media (min-width:640px){.nav-item-hover{font-weight:600}}.nav-item-hover:active,.nav-item-hover:focus,.nav-item-hover:hover{color:#fff;background-color:#33332d!important}.nav-item-hover:active,.nav-item-hover:focus{outline:2px solid #706be4}.flex-fix-aligning:after,.flex-fix-aligning:before{content:"";width:30%;order:2}.index__main-title{font-size:1.571rem}@media (min-width:992px){.index__main-title{font-size:3rem}}.auto-bottom-margin{margin-bottom:auto}@media (min-width:992px){.absolute-top-right--desktop{position:absolute;top:0;right:0}}@media (min-width:640px){.frontpage__hero .image{top:-2em}}@media (min-width:992px){.frontpage__hero{flex-direction:column}.frontpage__hero .image{top:4em}}.heading-font{font-family:IBM Plex Sans,monospace}.about__challenge-button{box-shadow:-3px 5px #33332d;padding:.6rem 1rem;border:3px solid #33332d;font-weight:600}.about__challenge-button:hover{background-color:#33332d;color:#fff;cursor:pointer}.about__challenge-button--turquoise{background-color:#82f7eb}@media (max-width:1299px){.space-between--mobile{justify-content:space-between}}.challenge__banner{display:flex;justify-content:center;margin-bottom:-70px}@media (min-width:640px){.challenge__banner{transform:translateY(-10px)}}@media (min-width:1300px){.challenge__banner{margin-bottom:-370px}}.challenge__banner .image{margin:0;width:70%;transform:translateY(-25%)}@media (min-width:640px){.challenge__banner .image{transform:translateY(-10%)}}@media (min-width:1300px){.challenge__banner .image{transform:translateY(-30%)}}.header{position:-webkit-sticky;position:sticky;z-index:9999999999;top:0;box-sizing:border-box;width:100%;padding-top:1.444rem;padding-bottom:1rem;transition:all .2s ease-in-out}.header--small{pointer-events:none}.header__logo{margin:0 10px;pointer-events:auto}.navigation{z-index:2;list-style:none;opacity:0;display:none;margin:0;padding:5%;flex-direction:column;justify-content:center;align-items:center;background:#e1e1e1;position:fixed;top:8%;right:5%;transition:opacity .3s ease-in-out;font-weight:200}@media (min-width:1300px){.navigation{display:flex;opacity:1;padding:0;font-weight:400;position:static;background:none;overflow:hidden;flex-direction:row}}@media (max-width:1299px){.navigation__wrapper .language-switcher{margin:20px 0 0}}@media (min-width:1300px){.navigation__wrapper{flex-grow:100}}.navigation__language-picker{margin-left:auto}.navigation__toggle{z-index:3;position:absolute;top:0;right:0;width:50px;height:40px;cursor:pointer;border:none;background:none;outline:none;border-radius:4px}@media (min-width:1300px){.navigation__toggle{display:none}}.navigation__mobile-logo{display:none}.navigation__toggle-icon{top:8px;left:10px}.navigation__toggle-icon,.navigation__toggle-icon:after,.navigation__toggle-icon:before{position:absolute;width:30px;height:3px;transition:all .3s ease;border-radius:4px;background-color:#33332d}.navigation__toggle-icon:after,.navigation__toggle-icon:before{content:"";display:block}.navigation__toggle-icon:before{top:10px}.navigation__toggle-icon:after{top:20px}.is-open--navigation{overflow:hidden;height:100vh}.is-open--navigation .navigation{opacity:1;display:unset}.is-open--navigation .navigation:before{content:"";background-color:#e1e1e1;position:absolute;width:25px;height:25px;top:-3px;right:13px;transform:rotate(45deg)}.is-open--navigation .navigation__mobile-logo{display:block;width:30px;height:30px;position:absolute;top:47px;left:5%}@media (min-width:1300px){.is-open--navigation .navigation__mobile-logo{display:none}}.is-open--navigation .navigation__toggle-icon{transform:translate3d(0,10px,0) rotate(45deg)}.is-open--navigation .navigation__toggle-icon,.is-open--navigation .navigation__toggle-icon:after,.is-open--navigation .navigation__toggle-icon:before{background:#33332d}.is-open--navigation .navigation__toggle-icon:before{transform:rotate(-45deg) translate3d(-5.71429px,-6px,0);opacity:0}.is-open--navigation .navigation__toggle-icon:after{transform:translate3d(0,-19px,0) rotate(-90deg)}.navigation__item{margin:22px 0;white-space:nowrap}.navigation__item:first-of-type{margin:0 0 22px}.navigation__item:last-of-type{margin:22px 0 0}@media (min-width:1300px){.navigation__item{margin:0 30px;padding:0!important}.navigation__item:first-of-type{margin:0 30px 0 2rem}.navigation__item:last-of-type{margin:0 0 0 30px}}.LanguagePicker-module--select--364N3{padding:3px 6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:1px solid #33332d;border-radius:5px;color:inherit;background-color:#fff;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='none' stroke='%23333333' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 6px center;background-size:16px 12px;width:6.5rem}.SvgIcon-module--svgIcon--1nGJ6{-webkit-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;flex-shrink:0;font-size:1.5rem}.SrOnly-module--srOnly--2Hn2L{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.SearchLink-module--searchLink--2IShR{margin-left:auto;border-radius:4px;padding:4px;display:inline-flex}.SearchLink-module--searchLink--2IShR:hover{background-color:#33332d;color:#fff}.triple-border{position:relative;padding:2px;border-radius:5px 0;transition:color .1s ease-in-out,background-color .1s ease-in-out}.triple-border:after,.triple-border:before{z-index:2;content:"";border:2px solid #33332d;border-radius:5px;position:absolute;width:calc(100% + 5px);height:calc(100% + 5px)}.triple-border:before{left:0;top:0}.triple-border:after{bottom:0;right:0}.triple-border__container{position:relative;overflow:hidden;border-radius:3px 0}.triple-border--large-margin{margin:13px;padding:3px}.triple-border--large-margin:after,.triple-border--large-margin:before{content:"";border-width:3px;border-radius:13px;width:calc(100% + 13px);height:calc(100% + 13px)}.triple-border--large-margin .triple-border__container{border-radius:10px 0}.triple-border__logo{padding:.2rem;font-size:1.111rem;font-weight:600}.triple-border__return-tasks{font-size:.9rem;padding:1rem .2rem}.image__content{position:absolute;top:0;left:0;height:100%;width:100%;-o-object-fit:cover;object-fit:cover}.image--contain .image__content{-o-object-fit:contain;object-fit:contain}.image{overflow:hidden;width:100%;position:relative}@media (min-width:992px){.image{width:40%}}.image .image__container{height:0;position:relative;width:100%;padding-bottom:89.0625%}.image--circle{border-radius:50%}.image--circle .image__content{background-color:#e1e1e1}.image--square-big{width:100%}.image--square-big .image__container{width:100%;padding-bottom:100%}.image--extra-small{width:8%}.image--extra-small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--extra-small{width:calc(33.33333% - 1rem)}}.image--small{width:15%}.image--small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--small{width:calc(33.33333% - 1rem)}}.image--medium{width:50%}.image--medium .image__container{width:100%;padding-bottom:71.25%}.image--large{width:100%}@media (min-width:992px){.image--large{width:60%}}.image--large .image__container{padding-bottom:59.37%;width:100%}.image--full-width{width:100%}.image--full-width .image__container{padding-bottom:59.37%;width:100%}.image--actual-size{width:100%}.image--actual-size .image__container{height:0;position:relative;width:100%;padding-bottom:60%}.form p{font-family:IBM Plex Sans,monospace;font-size:.9rem;margin-bottom:10px}.form input{padding:1rem;border:1px solid #e1e1e1;outline:0}.form input:focus{border:1px solid #33332d}.form .submit{border:3px solid #33332d;background-color:#e1e1e1;padding:.7rem 2rem}.form .submit:hover{cursor:pointer;background-color:#33332d;color:#fff}.developer-story__image{margin-bottom:auto}.developer-story__name{margin-top:4rem;font-size:1.2rem}.developer-story__title{font-size:.9rem}.developer-story__read-more{margin-top:2rem;line-height:1.1rem;width:auto;background:none;color:inherit;padding:0!important;border:none;border-bottom:2px solid #e1e1e1;cursor:pointer}.developer-story__read-more:hover{background-color:#e1e1e1}.some-logo__link{margin:1rem 1rem 0 0;display:inline-block}.some-logo__image{width:1.5rem;height:1.5rem;margin:0}#footer{margin-top:auto}@media (min-width:992px){#footer{align-items:center}}#footer a:hover{background-color:transparent!important}#footer .footer__navigation{display:none}@media (max-width:1299px){#footer .footer__navigation{width:100%;display:block}#footer .footer__navigation-link-container{display:flex;flex-direction:column}}#footer .footer__navigation-link{font-size:1rem;line-height:18px;white-space:nowrap;font-family:IBM Plex Sans,monospace;margin-left:0!important;margin-right:auto}@media (max-width:639px){#footer .footer__navigation-link{line-height:8px}}#footer .footer__navigation-link:hover{color:#fff!important;background-color:#33332d!important}#footer .footer__navigation-link:nth-of-type(n+2){margin-top:2.142rem}@media (min-width:1300px){#footer .footer__navigation{flex-direction:row;flex-wrap:nowrap;justify-content:flex-end}#footer .footer__navigation-link{margin-top:0!important;margin-bottom:auto}#footer .footer__navigation-link:nth-of-type(n+1){margin-right:2.877rem}#footer .footer__navigation-link:last-of-type{margin-right:0!important}}.prev-next__container .separator{display:none}@media (max-width:639px){.prev-next__container .separator{display:block;background-color:#33332d;width:2px!important}}.prev-next__container .prev b,.prev-next__container .prev p{text-align:right}@media (max-width:639px){.prev-next__container .prev p:before{content:"<";margin-right:1rem}}@media (max-width:639px){.prev-next__container .next p:after{content:">";margin-left:1rem}}.scroll-navigation-container{display:none}@media (min-width:992px){.scroll-navigation-container{pointer-events:none;display:block;font-size:16px;position:-webkit-sticky;position:sticky;width:100%;margin-right:-100%;left:0;top:-100px;padding-top:200px}}.scroll-navigation-container-inner{width:90%;margin:0 auto;max-width:1200px}.scroll-navigation{pointer-events:auto;display:flex;width:30%;max-width:30%/.9;height:100%;overflow-y:auto;max-height:calc(100vh - 100px);padding-right:1rem;z-index:199}.scroll-navigation li{list-style-type:none}.scroll-navigation li.selected a,.scroll-navigation li:hover a{background-color:#33332d;color:#fff!important}.scroll-navigation li:before{content:"-"}.left-navigation-link{padding-left:1.2rem;text-indent:-1.2rem;display:block}.left-navigation-link:hover{background-color:#33332d!important;color:#fff!important}.level-h1{font-weight:700;padding-left:2.8rem;text-indent:-2.8rem}.level-h2{padding-left:1.6rem;text-indent:-1.6rem}.sub-header{color:#33332d;font-family:IBM Plex Mono,monospace;padding-bottom:1.357rem}@media (min-width:992px){.sub-header{padding-bottom:2.333rem}}.InputField-module--inputField--3oXh5{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;border:0;font-family:inherit;padding:16px 12px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.3);color:#000;transition:all .15s ease}.InputField-module--inputField--3oXh5:hover{box-shadow:inset 0 -2px 0 rgba(0,0,0,.4)}.InputField-module--inputField--3oXh5:focus{outline:none;box-shadow:inset 0 -2px 0 rgba(0,0,0,.5)}</style><meta name="generator" content="Gatsby 2.23.22"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Fullstack part13 | </title><meta data-react-helmet="true" name="description" content="Open online course on JavaScript based modern web development by University of Helsinki and Houston Inc.."/><meta data-react-helmet="true" property="og:title" content="Fullstack part13 | "/><meta data-react-helmet="true" property="og:description" content="Open online course on JavaScript based modern web development by University of Helsinki and Houston Inc.."/><meta data-react-helmet="true" name="og:image" content="/static/EYE_green_wide-0a72f74a959f54d0f3e4bb8c67f6f158.jpg"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Houston Inc. Consulting oy"/><meta data-react-helmet="true" name="twitter:title" content="Fullstack part13 | "/><meta data-react-helmet="true" name="twitter:description" content="Open online course on JavaScript based modern web development by University of Helsinki and Houston Inc.."/><meta data-react-helmet="true" name="twitter:image" content="/static/EYE_green_wide-0a72f74a959f54d0f3e4bb8c67f6f158.jpg"/><meta data-react-helmet="true" name="google-site-verification" content="ds9pQKiK3kjhRSHHbf5ccoG-oJggn7Lq4A8uHxM3Mkw"/><meta data-react-helmet="true" name="keywords" content="fullstack, Full stack -websovelluskehitys, course, helsingin yliopisto, tietojenkäsittelytieteen osasto, mooc, mooc.fi, full stack, full stack open, web-sovelluskehitys, web, houston, houston inc, websovelluskehitys, web-sovellus, React, Redux, Node.js, Node, MongoDB, GraphQL, REST, REST api, single page -sovellus, ohjelmointi, university of helsinki, department of computer science, web development, software development, web, web application, single page app, programming, "/><link rel="icon" href="/favicon-32x32.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#e1e1e1"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=6460c405ec32c913ef778f48c5ab192e"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="canonical" href="https://fullstackopen.com/en/part13/migrations_many_to_many_relationships" data-baseprotocol="https:" data-basehost="fullstackopen.com"/><link as="script" rel="preload" href="/e4b9374bcd292c90587e3ccf579324c3065ac22f-91cf5431cb3e1fc76518.js"/><link as="script" rel="preload" href="/app-1d86594356fc279bc7bd.js"/><link as="script" rel="preload" href="/component---src-templates-content-template-js-128130c8a3514bd9602a.js"/><link as="script" rel="preload" href="/ff8e348e8d42e8d61f84312613c75c948ce81396-73e1478ec1d8afda6a11.js"/><link as="script" rel="preload" href="/styles-89fd2ae28bdf06750a71.js"/><link as="script" rel="preload" href="/5d7a54886b2742230021cc39eab839038eb7a677-7e0df6a64154312ad871.js"/><link as="script" rel="preload" href="/30844a71ec80b1e82ad30323d06b914984ff6c2b-bfbd018b7380e158211d.js"/><link as="script" rel="preload" href="/commons-e2b868f99a021228e0f0.js"/><link as="script" rel="preload" href="/framework-8cb3270495e919798e3b.js"/><link as="script" rel="preload" href="/webpack-runtime-cc90f1d82ce6ab0fdcd6.js"/><link as="fetch" rel="preload" href="/page-data/en/part13/migrations_many_to_many_relationships/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="main-wrapper"><div class="header " style="background-color:white"><div class="container" style="align-items:center;justify-content:flex-start"><a class="header__logo" href="/"><div class="triple-border nav-item-hover " style="padding:0.2em"><div class="triple-border__container triple-border__logo" style="background-color:transparent;z-index:10">{() =&gt; fs}</div></div></a><div class="navigation__wrapper "><button aria-label="Navigation menu" aria-expanded="false" class="navigation__toggle"><div class="navigation__toggle-icon"></div></button><nav><ul class="navigation"><li class="navigation__item "><a class="nav-item-hover" href="/en/about">About course</a></li><li class="navigation__item "><a class="nav-item-hover" href="/en/#course-contents">Course contents</a></li><li class="navigation__item "><a class="nav-item-hover" href="/en/faq">FAQ</a></li><li class="navigation__item "><a class="nav-item-hover" href="/en/companies">Partners</a></li><li class="navigation__item "><a class="nav-item-hover" href="/en/challenge">Challenge</a></li><a class="SearchLink-module--searchLink--2IShR" href="/en/search"><span class="SrOnly-module--srOnly--2Hn2L">Search from the material</span><svg role="img" viewBox="0 0 24 24" class="SvgIcon-module--svgIcon--1nGJ6"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></a><select class="navigation__language-picker LanguagePicker-module--select--364N3"><option value="fi">Suomi</option><option selected="" value="en">English</option><option value="zh">中文</option><option value="es">Spanish</option></select></ul></nav></div></div></div><div class="course-container spacing--after"><div class="banner part-main__banner spacing--mobile--small" style="background-image:url(/static/a912ccd5077570e9e5104b4d7b908c3c/part-13.svg);background-color:#C5FF73"><div class="container spacing--after"><div class="col-10 spacing--after"><div class="arrow__container arrows--horizontal breadcrumb"><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#C5FF73;color:#33332d"><a href="/en/#course-contents">Fullstack</a></div><div class="arrow__point " style="background-color:#C5FF73;color:#33332d"></div></div><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#C5FF73;color:#33332d"><a href="/en/part13">Part 13</a></div><div class="arrow__point " style="background-color:#C5FF73;color:#33332d"></div></div><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#33332d;color:white">Migrations, many-to-many relationships</div><div class="arrow__point " style="background-color:#33332d;color:white"></div></div></div></div></div></div><div class="course "><div class="scroll-navigation-container "><div class="scroll-navigation-container-inner "><div class="scroll-navigation  element--column" tag="ul"><a class="left-navigation-link" style="border-color:#C5FF73" href="/en/part13/using_relational_databases_with_sequelize">a Using relational databases with Sequelize</a><a class="left-navigation-link" style="border-color:#C5FF73" href="/en/part13/join_tables_and_queries">b Join tables and queries</a><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  " style="background-color:#C5FF73;border-color:#C5FF73">c Migrations, many-to-many relationships</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div></div></div></div><div class="course-content-container "><div class="course-content element--auto-bottom-margin"><div class="course-content-inner "><p class="col-1 letter" style="border-color:#C5FF73">c</p><h1 class="sub-header ">Migrations, many-to-many relationships</h1></div></div><div class="course-content "><div class="course-content-inner ">
<h3>Migrations</h3>
<p>Continuing to extend the backend. We want to implement support for allowing users with <i>admin status</i> to put users of their choice in inactive mode, preventing them from logging in and creating new notes. To implement these, we need to add a boolean value to the users&#x27; database row indicating whether the user is admin and whether the username is inactive. </p>
<p>We could proceed as before, i.e. change the model that defines the table and rely on Sequelize to synchronize the changes to the database. This is triggered by the lines in the file <code class="language-text">models/index.js</code></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> Note <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./note&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./user&#x27;</span><span class="token punctuation">)</span>

Note<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>
User<span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span>Note<span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">Note<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> alter<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">User<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> alter<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">,</span> User
<span class="token punctuation">}</span></code></pre></div>
<p>However, this approach does not make sense in the long run. Let&#x27;s remove the lines that do the synchronization and move to a much more robust way, the <a href="https://sequelize.org/master/manual/migrations.html">migrations</a> provided by Sequelize (and many other libraries).</p>
<p>In practice, a migration is a single JavaScript file that describes some change to the database. A separate migration file is created for each single or multiple changes at once. Sequelize keeps a record of which migrations have been performed, i.e. which migrations have caused the change to be synchronized with the database schema. As new migrations are created, Sequelize keeps up to date with which changes to the database schema are still outstanding. In this way, changes are made in a controlled manner, with the program code stored in the version control system.</p>
<p>First, a migration is created that takes the database to its current state. The code for the migration is as follows</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> DataTypes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&#x27;notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      important<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">BOOLEAN</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      date<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      username<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
        unique<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&#x27;notes&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;user_id&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&#x27;notes&#x27;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&#x27;users&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The migration file contains the [specified](https://sequelize.org/master/manual/migrations.html#migration-skeleton) functions &lt;i&gt;up&lt;/i&gt; and &lt;i&gt;down&lt;/i&gt;, the first of which defines how the database should be modified when the migration is performed. The &lt;i&gt;down&lt;/i&gt; function tells you how to undo the migration if you need to do so.

Our migration contains three operations, the first creates a table &lt;i&gt;notes&lt;/i&gt;, the second creates a table &lt;i&gt;users&lt;/i&gt; and the third adds a reference key to the table &lt;i&gt;notes&lt;/i&gt; for the creator of the note. Scheme changes are specified by calling methods in the [queryInterface](https://sequelize.org/master/manual/query-interface.html) colio.

Save the migration code in the file &lt;i&gt;migrations/20211209_00_initialize_notes_and_users.js&lt;/i&gt;. The migration file names should be in alphabetical order so that the previous migration is always alphabetically above the newer migration. A good way to achieve this order is to start the migration file name with a date and a sequence number. 

We could run the migrations from the command line using the [Sequelize command line tool](https://github.com/sequelize/cli). However, we decide to perform the migrations manually from the program code using the [Umzug](https://github.com/sequelize/umzug) library. Installing the library

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
npm install umzug
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The database connection file &lt;i&gt;utils/db.js&lt;/i&gt; will be modified as follows

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">DATABASE_URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./config&#x27;</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> move <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;move&#x27;</span><span class="token punctuation">)</span></span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token constant">DATABASE_URL</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  dialectOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    ssl<span class="token operator">:</span> <span class="token punctuation">{</span>
      require<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      rejectUnauthorized<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token function-variable function">runMigrations</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> migrator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    storage<span class="token operator">:</span> <span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    storageOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      sequelize<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      tableName<span class="token operator">:</span> <span class="token string">&#x27;migrations&#x27;</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    migrations<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      params<span class="token operator">:</span> <span class="token punctuation">[</span>sequelize<span class="token punctuation">.</span><span class="token function">getQueryInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/migrations</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      pattern<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> migrations <span class="token operator">=</span> <span class="token keyword">await</span> migrator<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Migrations up to date&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    files<span class="token operator">:</span> migrations<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mig</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mig<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span>
<span class="token keyword">const</span> <span class="token function-variable function">connectToDatabase</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">await</span> <span class="token function">runMigrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;database connected&#x27;</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;connecting database failed&#x27;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> connectToDatabase<span class="token punctuation">,</span> sequelize <span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The &lt;i&gt;runMigrations&lt;/i&gt; function that performs migrations is now executed every time the application opens a database connection when it starts. Sequelize keeps track of which migrations have already been run, so if there are no new migrations, running the &lt;i&gt;runMigrations&lt;/i&gt; function does nothing. 

Let&#x27;s now start with a clean slate and remove all existing database tables from the application:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>sql
<span class="token parameter">username</span> <span class="token operator">=&gt;</span> drop table notes<span class="token punctuation">;</span>
<span class="token parameter">username</span> <span class="token operator">=&gt;</span> drop table users<span class="token punctuation">;</span>
<span class="token parameter">username</span> <span class="token operator">=&gt;</span> \d
Did not find any relations<span class="token punctuation">.</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Let&#x27;s fire up the application. A message is printed to the log indicating the status of the migrations

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
<span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token string">&quot;migrations&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span> <span class="token constant">RETURNING</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">;</span>
Migrations up to date <span class="token punctuation">{</span> files<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#x27;20211209_00_initialize_notes_and_users.js&#x27;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
database connected
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

If we restart the application, the log also shows that the migration is not being performed.

The database schema of the application now looks like this

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token parameter">username</span><span class="token operator">=&gt;</span> \d
                 List <span class="token keyword">of</span> relations
 Schema <span class="token operator">|</span> Name <span class="token operator">|</span> Type <span class="token operator">|</span> Owner
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
 <span class="token keyword">public</span> <span class="token operator">|</span> migrations <span class="token operator">|</span> table <span class="token operator">|</span> owxxgvitdspkma
 <span class="token keyword">public</span> <span class="token operator">|</span> notes <span class="token operator">|</span> table <span class="token operator">|</span> owxxgvitdspkma
 <span class="token keyword">public</span> <span class="token operator">|</span> notes_id_seq <span class="token operator">|</span> sequence <span class="token operator">|</span> owxxgvitdspkma
 <span class="token keyword">public</span> <span class="token operator">|</span> users <span class="token operator">|</span> table <span class="token operator">|</span> owxxgvitdspkma
 <span class="token keyword">public</span> <span class="token operator">|</span> users_id_seq <span class="token operator">|</span> sequence <span class="token operator">|</span> owxxgvitdspkma
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

So Sequelize has created a table &lt;i&gt;migrations&lt;/i&gt; which it uses to keep track of the migrations that have been performed. The contents of the table look like this:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token parameter">username</span><span class="token operator">=&gt;</span> select <span class="token operator">*</span> <span class="token keyword">from</span> migrations<span class="token punctuation">;</span>
                   name
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
 <span class="token number">20211209_00</span>_initialize_notes_and_users<span class="token punctuation">.</span>js
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Let&#x27;s create a few users and a set of notes in the database, and then we&#x27;re ready to extend the application.

The current code for the application is available in full at [github](https://github.com/fullstack-hy/part12-notes/tree/part12-6), branch &lt;i&gt;part12-6&lt;/i&gt;.
### Admin user and user disabling

So we want to add two boolean fields to the &lt;i&gt;users&lt;/i&gt; table 
- _admin_ tells whether the user is admin
- _disabled_ tells us if the user is disabled

Let&#x27;s create a migration that creates a database instance in the file &lt;i&gt;migrations/20211209_01_admin_and_disabled_to_users.js&lt;/i&gt;:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> DataTypes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">BOOLEAN</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;disabled&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">BOOLEAN</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">removeColumn</span><span class="token punctuation">(</span><span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">removeColumn</span><span class="token punctuation">(</span><span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;disabled&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Make the corresponding changes to the model corresponding to the table&lt;i&gt;users&lt;/i&gt;:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
User<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    unique<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">  admin<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">BOOLEAN</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    defaultValue<span class="token operator">:</span> <span class="token boolean">false</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  disabled<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">BOOLEAN</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    defaultValue<span class="token operator">:</span> <span class="token boolean">false</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">,</span>
  underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  modelName<span class="token operator">:</span> <span class="token string">&#x27;user&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

When the new migration is performed on code restart, the schema will change as desired:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>sql
username<span class="token operator">-</span><span class="token operator">&gt;</span> \d users
                                     Table <span class="token string">&quot;public.users&quot;</span>
  Column <span class="token operator">|</span> Type <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span> Default
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
 id <span class="token operator">|</span> integer <span class="token operator">|</span> not <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token function">nextval</span><span class="token punctuation">(</span><span class="token string">&#x27;users_id_seq&#x27;</span><span class="token operator">:</span><span class="token operator">:</span>regclass<span class="token punctuation">)</span>
 username <span class="token operator">|</span> character <span class="token function">varying</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> not <span class="token keyword">null</span> <span class="token operator">|</span>
 name <span class="token operator">|</span> character <span class="token function">varying</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">|</span> not <span class="token keyword">null</span> <span class="token operator">|</span>
 admin <span class="token operator">|</span> boolean <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>
 disabled <span class="token operator">|</span> boolean <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>
Indexes<span class="token operator">:</span>
    <span class="token string">&quot;users_pkey&quot;</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span><span class="token punctuation">,</span> <span class="token function">btree</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token string">&quot;users_username_key&quot;</span> <span class="token constant">UNIQUE</span> <span class="token constant">CONSTRAINT</span><span class="token punctuation">,</span> <span class="token function">btree</span> <span class="token punctuation">(</span>username<span class="token punctuation">)</span>
Referenced by<span class="token operator">:</span>
    <span class="token constant">TABLE</span> <span class="token string">&quot;notes&quot;</span> <span class="token constant">CONSTRAINT</span> <span class="token string">&quot;notes_user_id_fkey&quot;</span> <span class="token constant">FOREIGN</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token constant">REFERENCES</span> <span class="token function">users</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Now let&#x27;s extend the controllers as follows. Prevent logging if the user field </span><span class="token template-punctuation string">`</span></span>disabled<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> is already set to </span><span class="token template-punctuation string">`</span></span><span class="token boolean">true</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
loginRouter<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> request<span class="token punctuation">.</span>body

  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    where<span class="token operator">:</span> <span class="token punctuation">{</span> 
      username<span class="token operator">:</span> body<span class="token punctuation">.</span>username
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">const</span> passwordCorrect <span class="token operator">=</span> body<span class="token punctuation">.</span>password <span class="token operator">===</span> <span class="token string">&#x27;secret&#x27;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> passwordCorrect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      error<span class="token operator">:</span> <span class="token string">&#x27;invalid username or password&#x27;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>disabled<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      error<span class="token operator">:</span> <span class="token string">&#x27;account disabled, please contact admin&#x27;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token keyword">const</span> userForToken <span class="token operator">=</span> <span class="token punctuation">{</span>
    username<span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> 
    id<span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>userForToken<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECRET</span><span class="token punctuation">)</span>

  response
    <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> token<span class="token punctuation">,</span> username<span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> name<span class="token operator">:</span> user<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Disabloys the user&#x27;s </span><span class="token template-punctuation string">`</span></span>jacket<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> token:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>sql
<span class="token parameter">username</span> <span class="token operator">=&gt;</span> update users <span class="token keyword">set</span> disabled<span class="token operator">=</span><span class="token boolean">true</span> where id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token constant">UPDATE</span> <span class="token number">1</span>
<span class="token parameter">username</span> <span class="token operator">=&gt;</span> update users <span class="token keyword">set</span> admin<span class="token operator">=</span><span class="token boolean">true</span> where id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token constant">UPDATE</span> <span class="token number">1</span>
<span class="token parameter">username</span> <span class="token operator">=&gt;</span> select <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">;</span>
 id <span class="token operator">|</span> username <span class="token operator">|</span> name <span class="token operator">|</span> admin <span class="token operator">|</span> disabled
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
  <span class="token number">2</span> <span class="token operator">|</span> jakousa <span class="token operator">|</span> Jami Kousa <span class="token operator">|</span> <span class="token operator">|</span> t
  <span class="token number">1</span> <span class="token operator">|</span> mluukkai <span class="token operator">|</span> Matti Luukkainen <span class="token operator">|</span> t
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

And make sure that the login is no longer successful:

PICTURE

Let&#x27;s make a message route that allows the admin to change the status of the user&#x27;s account

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token function-variable function">isAdmin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>decodedToken<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>admin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token string">&#x27;operation not allowed&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&#x27;/:username&#x27;</span><span class="token punctuation">,</span> tokenExtractor<span class="token punctuation">,</span> isAdmin<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    where<span class="token operator">:</span> <span class="token punctuation">{</span> 
      username<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>username
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">.</span>disabled <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>disabled
    <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

There are two middleware, the first called &lt;i&gt;tokenExtractor&lt;/i&gt; is the same as the one used by the note-generating route, i.e. it places the decoded token in the request-olio field &lt;i&gt;decodedToken&lt;/i&gt;. The second in sequence middleware &lt;i&gt;isAdmin&lt;/i&gt; checks if the user is admin, and if not, the request is set to 401 and an appropriate error message is returned.

Note how the route handler thus has &lt;i&gt;two middlewares&lt;/i&gt; chained together, both of which are executed before the actual route handler. It is possible to chain an arbitrary number of middleware to a request.

The middleware &lt;i&gt;tokenExtractor&lt;/i&gt; is now moved to &lt;i&gt;util/middleware.js&lt;/i&gt; because it is used from multiple locations.

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;jsonwebtoken&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">SECRET</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./config.js&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">tokenExtractor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> authorization <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;authorization&#x27;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>authorization <span class="token operator">&amp;&amp;</span> authorization<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#x27;bearer &#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span>decodedToken <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>authorization<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">SECRET</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token string">&#x27;token invalid&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token string">&#x27;token missing&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> tokenExtractor <span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The admin can now enablethe token for the java by making a PUT request to http://localhost:3001/api/users/jakousa with the following data included in the request:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token punctuation">{</span>
    <span class="token string">&quot;disabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

As noted in [the end of Part 4](/part4/token_based_login#token-based_login_problems), the way we implement disabling usernames here is problematic. Whether or not the token is disablocked is only checked at _login_, if the user is in possession of a token at the time the token is disablocked, the user can continue to use the same token, since there is no lifetime set for the token and the fact that the user&#x27;s token is disablocked is not checked at note creation. 

Before proceeding further, an npm script will be created for the application to undo the previous migration. After all, not everything always goes right the first time when developing migrations. 

Let&#x27;s modify the file &lt;i&gt;util/db.js&lt;/i&gt; as follows:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">DATABASE_URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./config&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> move <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;move&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token constant">DATABASE_URL</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  dialectOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    ssl<span class="token operator">:</span> <span class="token punctuation">{</span>
      require<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      rejectUnauthorized<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">connectToDatabase</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">runMigrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;database connected&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;connecting database failed&#x27;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> migrationConf <span class="token operator">=</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  storage<span class="token operator">:</span> <span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  storageOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    sequelize<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    tableName<span class="token operator">:</span> <span class="token string">&#x27;migrations&#x27;</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  migrations<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    params<span class="token operator">:</span> <span class="token punctuation">[</span>sequelize<span class="token punctuation">.</span><span class="token function">getQueryInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/migrations</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    pattern<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token function-variable function">runMigrations</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> migrator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">migration</span><span class="token punctuation">(</span>migrationConf<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> migrations <span class="token operator">=</span> <span class="token keyword">await</span> migrator<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Migrations up to date&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    files<span class="token operator">:</span> migrations<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mig</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mig<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token function-variable function">rollbackMigration</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> migrator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">move</span><span class="token punctuation">(</span>migrationConf<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">await</span> migrator<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span>
<span class="gatsby-highlight-code-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> connectToDatabase<span class="token punctuation">,</span> sequelize<span class="token punctuation">,</span> rollbackMigrations <span class="token punctuation">}</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Let&#x27;s create a file &lt;i&gt;util/rollback.js&lt;/i&gt; that will allow the npm script to execute the specified migration rollback function:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> rollbackMigrations <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./db&#x27;</span><span class="token punctuation">)</span>

<span class="token function">rollbackMigrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

and the script itself:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>json
<span class="token punctuation">{</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon index.js&quot;</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    <span class="token string">&quot;migration:down&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node util/rollback.js&quot;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

So now we can undo the previous migration by running _npm run migration:down_ from the command line. 

Migrations are automatically executed when the program is started. In the development phase of a program, it might sometimes be more appropriate to disable the automatic execution of migrations and do the migrations manually from the command line. 

The current code for the application can be found in full at [github](https://github.com/fullstack-hy/part12-notes/tree/part12-7), branch &lt;i&gt;part12-7&lt;/i&gt;.


&lt;/div&gt;

&lt;div class=&quot;tasks&quot;&gt;

### Tasks 13.17-13.18.

#### Task 13.17.

Delete all tables from the application database. 

Perform a migration that sets the database to its current state. Create &lt;i&gt;created\_at&lt;/i&gt; and &lt;i&gt;updated\_at&lt;/i&gt; [timestamps](https://sequelize.org/master/manual/model-basics.html#timestamps) for both tables. Note that you will have to create them yourself in the migration.

**NOTE:** if you have to delete tables from the command line (i.e. you don&#x27;t do the deletion by undoing the migration), you will have to delete the contents of the &lt;i&gt;migrations&lt;/i&gt; table if you want your program to be able to run the migrations again.

#### Task 13.18.

Extend your application (via migration) so that the blogs have a writing year, i.e., a field &lt;i&gt;year&lt;/i&gt; which is an integer at least equal to 1991 but not greater than the current year. Make sure the application gives the appropriate error message if an attempt is made to assign an invalid value to the year of writing.
 
&lt;/div&gt;

&lt;div class=&quot;content&quot;&gt;

### Many to many connections

Continue to extend the application so that each user can be added to one or more &lt;i&gt;tribes&lt;/i&gt;.

Since an arbitrary number of users can join one team, and one user can join an arbitrary number of teams, we are dealing with [many-to-many](https://sequelize.org/master/manual/assocs.html#many-to-many-relationships), a many-to-many type of connection, which is traditionally implemented in relational databases using a &lt;i&gt;connection table&lt;/i&gt;.

Let&#x27;s now generate the code required by the team and the connection table. The migration is as follows

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> DataTypes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&#x27;teams&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        unique<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&#x27;memberships&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      user_id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      team_id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;teams&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&#x27;teams&#x27;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&#x27;memberships&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The models contain almost the same code as the migration. The team model </span><span class="token template-punctuation string">`</span></span>models<span class="token operator">/</span>team<span class="token punctuation">.</span>js<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> DataTypes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../util/db&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Team</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Team<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    unique<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">,</span>
  underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  modelName<span class="token operator">:</span> <span class="token string">&#x27;team&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Team
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Dashboard model </span><span class="token template-punctuation string">`</span></span>models<span class="token operator">/</span>membership<span class="token punctuation">.</span>js<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> DataTypes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../util/db&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Membership</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Membership<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  user_id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  team_id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;teams&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">,</span>
  underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  modelName<span class="token operator">:</span> <span class="token string">&#x27;membership&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Membership
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

So we have given the dashboard a descriptive name, &lt;i&gt;membership&lt;/i&gt;. There is not always an apt name for a join table, in which case the name of the join table can be a combination of the names of the tables to be joined, e.g. &lt;i&gt;user_\teamas&lt;/i&gt; might suit our situation.

A small addition to the file &lt;i&gt;models/index.js&lt;/i&gt; will be made to link teams and users with the method [belongsToMany](https://sequelize.org/master/manual/assocs.html#implementation-3) also at code level.

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> Note <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./note&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./user&#x27;</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> Team <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./team&#x27;</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> Membership <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./membership&#x27;</span><span class="token punctuation">)</span></span>
Note<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>
User<span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span>Note<span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">User<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>Team<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> Membership <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">Team<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> Membership <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">,</span> User<span class="token punctuation">,</span> Team<span class="token punctuation">,</span> Membership
<span class="token punctuation">}</span>

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Now let&#x27;s create a couple of teams and a couple of memberships in the console:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
insert into <span class="token function">teams</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span><span class="token string">&#x27;toska&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into <span class="token function">teams</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span><span class="token string">&#x27;mosa climbers&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into <span class="token function">memberships</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> team_id<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into <span class="token function">memberships</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> team_id<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into <span class="token function">memberships</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> team_id<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Then insert in the route of all users the information about the user&#x27;s teams

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    include<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        model<span class="token operator">:</span> Note<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token comment">// hihhlight-start</span>
      <span class="token punctuation">{</span>
        model<span class="token operator">:</span> team<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;id&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// hihhlight-end</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The most observant will notice that the query that comes to the console now combines three tables. 

The solution is pretty good, but there is one flaw. The result also includes the attributes of the join table row even though we don&#x27;t want them:

IMAGE HERE

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">js
teams: [
  {
  name: &quot;toska&quot;,
  id: 2,
  membership: {
      id: 2,
      user_id: 1,
      team_id: 2,
      userId: 1,
      teamId: 2
    }
  },
  {
    name: &quot;mosa climbers&quot;,
    id: 3,
    membership: {
      id: 3,
      user_id: 1,
      team_id: 3,
      userId: 1,
      teamId: 3
    }
  }
]
</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>

<span class="token constant">A</span> careful reading <span class="token keyword">of</span> the documentation will find <span class="token punctuation">[</span>solution<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>sequelize<span class="token punctuation">.</span>org<span class="token operator">/</span>master<span class="token operator">/</span>manual<span class="token operator">/</span>advanced<span class="token operator">-</span>many<span class="token operator">-</span>to<span class="token operator">-</span>many<span class="token punctuation">.</span>html#specifying<span class="token operator">-</span>attributes<span class="token operator">-</span><span class="token keyword">from</span><span class="token operator">-</span>the<span class="token operator">-</span>through<span class="token operator">-</span>table<span class="token punctuation">)</span><span class="token operator">:</span>

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    include<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        model<span class="token operator">:</span> Note<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token punctuation">{</span>
        model<span class="token operator">:</span> Team<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;id&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">        through<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span></span>      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The current code for the application is available in its entirety on [github](https://github.com/fullstack-hy/part12-notes/tree/part12-8), in branch &lt;i&gt;part12-8&lt;/i&gt;.

### Note on the properties of Sequelize model objects

The specification of our models included the following lines:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
User<span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span>Note<span class="token punctuation">)</span>
User<span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span>Note<span class="token punctuation">)</span>

User<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>Team<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> Membership <span class="token punctuation">}</span><span class="token punctuation">)</span>
Team<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> Membership <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

These allow Sequelize to make queries that retrieve, for example, all notes of a user, or all members of a team.

The definitions also allow us to directly access the user&#x27;s notes, for example, in code. In the following, we will retrieve a user with id 1 and print the notes associated with that user:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  include<span class="token operator">:</span> <span class="token punctuation">{</span>
    model<span class="token operator">:</span> Note
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

user<span class="token punctuation">.</span>notes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">note</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>note<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The definition &lt;i&gt;User.hasMany(Note)&lt;/i&gt; thus associates an attribute &lt;i&gt;notes&lt;/i&gt; with &lt;i&gt;user&lt;/i&gt;, which gives access to the notes made by the user. The definition &lt;i&gt;User.belongsToMany(Team, { through: Membership }))&lt;/i&gt; similarly associates the &lt;i&gt;teams&lt;/i&gt; attribute to users, which is also accessible in code:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  include<span class="token operator">:</span> <span class="token punctuation">{</span>
    model<span class="token operator">:</span> team
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

user<span class="token punctuation">.</span>teams<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">team</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>team<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Suppose we wanted to return a json from a single user route containing the user name, username, and the number of notes created. We could try the following

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/:id&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    include<span class="token operator">:</span> <span class="token punctuation">{</span>
        model<span class="token operator">:</span> Note
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    user<span class="token punctuation">.</span>note_count <span class="token operator">=</span> user<span class="token punctuation">.</span>notes<span class="token punctuation">.</span>length</span><span class="gatsby-highlight-code-line">    <span class="token keyword">delete</span> user<span class="token punctuation">.</span>notes</span>    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

So, we tried to include the &lt;i&gt;note_\count&lt;/i&gt; field in the returned object by Sequelize and remove the &lt;i&gt;notes&lt;/i&gt; field from it. However, this approach does not work, because the objects returned by Sequelize are not normal objects, and adding new fields to them works the way we want. 

A better solution is to create a completely new entity based on the data retrieved from the database:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/:id&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    include<span class="token operator">:</span> <span class="token punctuation">{</span>
        model<span class="token operator">:</span> Note
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      username<span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      name<span class="token operator">:</span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      note_count<span class="token operator">:</span> user<span class="token punctuation">.</span>notes<span class="token punctuation">.</span>length</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
### Many to many again

Let&#x27;s make another many-to-many relation in the application. Each black mark is associated with the user who created it via a reference key. It is decided that the application also supports that a note can be associated with other users, and that a user can be associated with an arbitrary number of notes created by another user. It is assumed that these notes are those that the user has &lt;i&gt;marked&lt;/i&gt; for himself.

Let&#x27;s make a chalkboard </span><span class="token template-punctuation string">`</span></span>user_notes<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> for this situation. The migration is straightforward:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> DataTypes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&#x27;user_notes&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      user_id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      note_id<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;notes&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&#x27;user_notes&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

There is nothing special about the model either:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> DataTypes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../util/db&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">UserNotes</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

UserNotes<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  user_id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;users&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  note_id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    references<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token string">&#x27;notes&#x27;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&#x27;id&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">,</span>
  underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  modelName<span class="token operator">:</span> <span class="token string">&#x27;user_notes&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserNotes
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The </span><span class="token template-punctuation string">`</span></span>models<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> file, on the other hand, is a slight change from what we saw earlier:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> Note <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./note&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./user&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Team <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./team&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Membership <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./membership&#x27;</span><span class="token punctuation">)</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> UserNotes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./user_notes&#x27;</span><span class="token punctuation">)</span></span>
Note<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>
User<span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span>Note<span class="token punctuation">)</span>

User<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>Team<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> Membership <span class="token punctuation">}</span><span class="token punctuation">)</span>
Team<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> Membership <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">User<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>Note<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> UserNotes<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">&#x27;marked_notes&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">Note<span class="token punctuation">.</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span> through<span class="token operator">:</span> UserNotes<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">&#x27;users_marked&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  Note<span class="token punctuation">,</span> User<span class="token punctuation">,</span> Team<span class="token punctuation">,</span> Membership<span class="token punctuation">,</span> UserNotes
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

In use again is &lt;i&gt;belongsToMany&lt;/i&gt; which links to the user notes via the model &lt;i&gt;UserNotes&lt;/i&gt; corresponding to the dashboard. However, this time we give the attribute formed using the keyword [as](https://sequelize.org/master/manual/advanced-many-to-many.html#aliases-and-custom-key-names) an &lt;i&gt;aliasname&lt;/i&gt;, the default name (for users &lt;i&gt;notes&lt;/i&gt;) would overlap with its previous meaning, i.e. user-generated notes. 

Extend the route for an individual user to return the user&#x27;s teams, his own notes, and any other notes associated with the user:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/:id&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">,</span>
    include<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
        model<span class="token operator">:</span> note<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> 
        model<span class="token operator">:</span> Note<span class="token punctuation">,</span> 
        <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">&#x27;marked_notes&#x27;</span><span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        through<span class="token operator">:</span> <span class="token punctuation">{</span>
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> <span class="token punctuation">{</span>
          model<span class="token operator">:</span> user<span class="token punctuation">,</span> 
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        model<span class="token operator">:</span> Team<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;id&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        through<span class="token operator">:</span> <span class="token punctuation">{</span>
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The include must now mention the </span><span class="token template-punctuation string">`</span></span><span class="token keyword">as</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> parameter using the alias we just defined &lt;i&gt;marked\_notes&lt;/i&gt;. 

In order to test the property, let&#x27;s create some test data in the database:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>sql
insert into <span class="token function">user_notes</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> note_id<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into <span class="token function">user_notes</span> <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> note_id<span class="token punctuation">)</span> <span class="token function">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The end result is functional:

IMAGE

What if we wanted the notes entered by the user to also contain information about the note author? This can be done by adding an </span><span class="token template-punctuation string">`</span></span>include<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> to the appendix kernel for notes.

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/:id&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">,</span>
    include<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
        model<span class="token operator">:</span> note<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> 
        model<span class="token operator">:</span> Note<span class="token punctuation">,</span> 
        <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">&#x27;marked_notes&#x27;</span><span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        through<span class="token operator">:</span> <span class="token punctuation">{</span>
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">        include<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">          model<span class="token operator">:</span> User<span class="token punctuation">,</span> </span><span class="gatsby-highlight-code-line">          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span></span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        model<span class="token operator">:</span> team<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;id&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        through<span class="token operator">:</span> <span class="token punctuation">{</span>
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">


The end result is as desired:

IMAGE

The current code of the application is available in full at [github](https://github.com/fullstack-hy/part12-notes/tree/part12-9), branch &lt;i&gt;part12-9&lt;/i&gt;.


&lt;/div&gt;

&lt;div class=&quot;tasks&quot;&gt;

### Tasks 13.19.-13.23.

#### Task 13.19.

Enable users to add blogs in the system to the &lt;i&gt;reading list&lt;/i&gt;. When added to the reading list, the blog is in the state &lt;i&gt;unread&lt;/i&gt;. The blog can later be marked as &lt;i&gt;read&lt;/i&gt;. Implement a reading list using a chalkboard.

In this task, adding to the reading list and displaying the list need not be done other than directly using the database.

#### Exercise 13.20.

Now add functionality to the application to support the reading list.

Adding a blog to the reading list is done by making an HTTP POST to the path &lt;i&gt;/api/readinglists&lt;/i&gt;, the request is accompanied by the blog and user id:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token punctuation">{</span>
  blog_id<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  user_id<span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Implement a single-user return path &lt;i&gt;/api/users/:id&lt;/i&gt; that returns not only the user&#x27;s other information but also a reading list, e.g. in the following format:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;Matti Luukkainen&quot;</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;mluukkai@iki.fi&quot;</span><span class="token punctuation">,</span>
  readings<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;https://google.com&quot;</span><span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Clean React&quot;</span><span class="token punctuation">,</span>
      author<span class="token operator">:</span> <span class="token string">&quot;Dan Abramov&quot;</span><span class="token punctuation">,</span>
      likes<span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
      year<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;https://google.com&quot;</span><span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Clean Code&quot;</span><span class="token punctuation">,</span>
      author<span class="token operator">:</span> <span class="token string">&quot;Bob Martin&quot;</span><span class="token punctuation">,</span>
      likes<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      year<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

At this point, information about whether the book has been read or not need not be available.

#### Task 13.21.

Extend the single-user view so that for each blog in the reading list, it also tells you whether the blog has been read &lt;i&gt;and&lt;/i&gt; the id of the corresponding chalkboard row.

For example, the information could be in the following format:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;Matti Luukkainen&quot;</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;mluukkai@iki.fi&quot;</span><span class="token punctuation">,</span>
  readings<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;https://google.com&quot;</span><span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Clean React&quot;</span><span class="token punctuation">,</span>
      author<span class="token operator">:</span> <span class="token string">&quot;Dan Abramov&quot;</span><span class="token punctuation">,</span>
      likes<span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
      year<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      readinglists<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          read<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          id<span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token string">&quot;https://google.com&quot;</span><span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Clean Code&quot;</span><span class="token punctuation">,</span>
      author<span class="token operator">:</span> <span class="token string">&quot;Bob Martin&quot;</span><span class="token punctuation">,</span>
      likes<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      year<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      readinglists<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          read<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          id<span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Note: there are several ways to implement this functionality. [This](https://sequelize.org/master/manual/advanced-many-to-many.html#the-best-of-both-worlds--the-super-many-to-many-relationship) should help.

#### Exercise 13.22.

Make it possible for the application to mark a blog on the reading list as read. To mark it as read, make a HTTP PUT request to the /api/readinglists/:id path, and send the request with

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token punctuation">{</span> read<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

A user can only mark as read blogs in their own reading list. The user is identified by the token that accompanies the request, as usual.

#### Exercise 13.23.

Modify the route for returning single user information, so that the request can be accompanied by a control of which blogs in the reading list are returned

- GET /api/users/:id returns the entire reading list
- GET /api/users/:id?read=true returns those blogs from the reading list that have been read
- GET /api/users/:id?read=false returns the blogs in the reading list that have not been read

&lt;/div&gt;

&lt;div class=&quot;content&quot;&gt;

### Final remarks

Our application is starting to be in at least decent shape. However, before the end of the section, let&#x27;s look at a few more points. 

#### Eager vs lazy fetch

When doing queries using the </span><span class="token template-punctuation string">`</span></span>include<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> attribute:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  include<span class="token operator">:</span> <span class="token punctuation">{</span>
    model<span class="token operator">:</span> note
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

A so-called [eager fetch](https://sequelize.org/master/manual/assocs.html#basics-of-queries-involving-associations) takes place, i.e. all rows of the tables to be joined to the row, in the example the notes related to the user, are fetched from the database at the same time. This is often what we want, but there are also situations where we want to do a _lazy fetch_, i.e. fetch, say, the user&#x27;s associated teams only if they are needed.

Let&#x27;s now modify the route for an individual user so that it will fetch the user&#x27;s teams from the database only if the query parameter </span><span class="token template-punctuation string">`</span></span>teams<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> is set for the request:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/:id&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">,</span>
    include<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
        model<span class="token operator">:</span> note<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> 
        model<span class="token operator">:</span> Note<span class="token punctuation">,</span> 
        <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">&#x27;marked_notes&#x27;</span><span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;userId&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        through<span class="token operator">:</span> <span class="token punctuation">{</span>
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> <span class="token punctuation">{</span>
          model<span class="token operator">:</span> user<span class="token punctuation">,</span> 
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// hightlight-start</span>
  <span class="token keyword">let</span> teams <span class="token operator">=</span> <span class="token keyword">undefined</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>teams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    teams <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">getTeams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      joinTableAttributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>user<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> teams <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// hightlight-end</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

So now the &lt;i&gt;User.findByPk&lt;/i&gt; query does not retrieve teams, but they are retrieved as needed by the &lt;i&gt;getTeams&lt;/i&gt; method of the &lt;i&gt;user&lt;/i&gt; object corresponding to the database row, which is automatically generated by Sequelize for the model object. The corresponding &lt;i&gt;get&lt;/i&gt; and a few other useful methods [are automatically generated](https://sequelize.org/master/manual/assocs.html#special-methods-mixins-added-to-instances) when defining associations for tables at the Sequelize level.

#### Model properties

There are some situations where by default we don&#x27;t want to handle all rows in a given table. One such case could be that we don&#x27;t normally want to display in our application those users whose ID is disabled (&lt;i&gt;disabled&lt;/i&gt;). In this situation, we could specify a default [scopen](https://sequelize.org/master/manual/scopes.html) for the model:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js 
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

User<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// field definition</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">,</span>
  underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  modelName<span class="token operator">:</span> <span class="token string">&#x27;user&#x27;</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">  defaultScope<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    where<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      disabled<span class="token operator">:</span> <span class="token boolean">false</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  scopes<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    admin<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      where<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        admin<span class="token operator">:</span> <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    disabled<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      where<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        disabled<span class="token operator">:</span> <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> User
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Now the query raised by the function call &lt;i&gt;User.findAll()&lt;/i&gt; has the following where-condition

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>
<span class="token constant">WHERE</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">.</span> <span class="token string">&quot;disabled&quot;</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

It is also possible to define other scopes for models:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js 
User<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// field definition</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">,</span>
  underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  modelName<span class="token operator">:</span> <span class="token string">&#x27;user&#x27;</span><span class="token punctuation">,</span>
  defaultScope<span class="token operator">:</span> <span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token punctuation">{</span>
      disabled<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">  scopes<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    admin<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      where<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        admin<span class="token operator">:</span> <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    disabled<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      where<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        disabled<span class="token operator">:</span> <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">return</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        where<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">          name<span class="token operator">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>iLike<span class="token punctuation">]</span><span class="token operator">:</span> value</span><span class="gatsby-highlight-code-line">          <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Scopes are used as follows

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token comment">// all admins</span>
<span class="token keyword">const</span> adminUsers <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// all inactive users</span>
<span class="token keyword">const</span> disabledUsers <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token string">&#x27;disabled&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// users with the string jami in their name</span>
<span class="token keyword">const</span> jamiUsers <span class="token operator">=</span> User<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;%jami%&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

It is also possible to chain scopes

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token comment">// admins with the string jami in their name</span>
<span class="token keyword">const</span> jamiUsers <span class="token operator">=</span> User<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;%jami%&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Since Sequelize models are normal [JavaScript classes](https://sequelize.org/master/manual/model-basics.html#taking-advantage-of-models-being-classes), it is possible to add new methods to them.

Here are two examples:

_TODO: should perhaps use camelCase in the names of the methods?_

_TODO: numberOfNotes could be a good example for a count method: https://sequelize.org/master/manual/model-querying-basics.html#-code-count--code-_

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> DataTypes<span class="token punctuation">,</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;sequelize&#x27;</span><span class="token punctuation">)</span> <span class="token comment">// hightlight-line</span>

<span class="token keyword">const</span> Note <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./note&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;../util/db&#x27;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token comment">// hightlight-start</span>
  <span class="token keyword">async</span> <span class="token function">number_of_notes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getNotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">with_notes</span><span class="token punctuation">(</span><span class="token parameter">limit</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      attributes<span class="token operator">:</span> <span class="token punctuation">{</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> sequelize<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">&quot;COUNT&quot;</span><span class="token punctuation">,</span> sequelize<span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token string">&quot;notes.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;note_count&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          model<span class="token operator">:</span> Note<span class="token punctuation">,</span>
          attributes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> 
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      group<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;user.id&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      having<span class="token operator">:</span> sequelize<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">COUNT(notes.id) &gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>limit<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// hightlight-end</span>
<span class="token punctuation">}</span>

User<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> User
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The first of the methods &lt;i&gt;note_count&lt;/i&gt; is an &lt;i&gt;instance method&lt;/i&gt;, meaning that it can be called on instances of the model:

_TODO: camelCase?_

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> jami <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;Jami Kousa&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cnt <span class="token operator">=</span> <span class="token keyword">await</span> jami<span class="token punctuation">.</span><span class="token function">number_of_notes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Jami has created </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cnt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> notes</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

Thus, within an instance method, the keyword &lt;i&gt;this&lt;/i&gt; refers to the instance itself:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">async</span> <span class="token function">number_of_notes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getNotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
<span class="token punctuation">}</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

The second of the methods, which returns those users with at least a parameter&#x27;s worth of notes, is again the &lt;i&gt;class method&lt;/i&gt;, i.e. it is called directly on the model:

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">with_notes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">u</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

#### Repetition of models and migrations

We have noticed that the code for models and migrations is very repetitive. For example, the model

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">js
class Team extends Model {}

Team.init({
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  name: {
    type: DataTypes.TEXT,
    allowNull: false,
    unique: true
  },
}, {
  sequelize,
  underscored: true,
  timestamps: false,
  modelName: &#x27;team&#x27;
})

module.exports = Team
</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>

and migration contain much the same

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">js
const { DataTypes } = require(&#x27;sequelize&#x27;)

module.exports = {
  up: async (queryInterface) =&gt; {
    await queryInterface.createTable(&#x27;teams&#x27;, {
      id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
      },
      name: {
        type: DataTypes.TEXT,
        allowNull: false,
        unique: true
      },
    })
  },
  down: async (queryInterface) =&gt; {
    await queryInterface.dropTable(&#x27;teams&#x27;)
  },
}
</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>

Couldn&#x27;t we optimize the code so that e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> the model exports the shared parts <span class="token keyword">for</span> migration<span class="token operator">?</span>

However<span class="token punctuation">,</span> the problem is that the definition <span class="token keyword">of</span> the model may change over time<span class="token punctuation">,</span> <span class="token keyword">for</span> example the field <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span> may change its name or its data type may change<span class="token punctuation">.</span> Migrations must be able to be performed successfully <span class="token keyword">from</span> start to finish at any time<span class="token punctuation">,</span> and <span class="token keyword">if</span> migrations rely on the model having a certain content<span class="token punctuation">,</span> <span class="token keyword">this</span> may no longer be the <span class="token keyword">case</span> after a month or a year<span class="token punctuation">.</span> Therefore<span class="token punctuation">,</span> the code <span class="token keyword">for</span> migrations should be completely separate <span class="token keyword">from</span> the code <span class="token keyword">for</span> models<span class="token punctuation">,</span> despite the <span class="token string">&quot;copy paste&quot;</span><span class="token punctuation">.</span>

One solution would be to use Sequelize <span class="token punctuation">[</span>command line tool<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>sequelize<span class="token punctuation">.</span>org<span class="token operator">/</span>master<span class="token operator">/</span>manual<span class="token operator">/</span>migrations<span class="token punctuation">.</span>html#creating<span class="token operator">-</span>the<span class="token operator">-</span>first<span class="token operator">-</span>model<span class="token operator">--</span>and<span class="token operator">-</span>migration<span class="token operator">-</span><span class="token punctuation">)</span><span class="token punctuation">,</span> which creates both models and migration files based on commands given on the command line<span class="token punctuation">.</span> For example<span class="token punctuation">,</span> the following command would create a model <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User</span><span class="token template-punctuation string">`</span></span> <span class="token keyword">with</span> attributes <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">username</span><span class="token template-punctuation string">`</span></span> and <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">admin</span><span class="token template-punctuation string">`</span></span> and a migration file to create the database table<span class="token operator">:</span>

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
npx sequelize-cli model:generate --name User --attributes name:string,username:string,admin:boolean
</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>

From the command line<span class="token punctuation">,</span> you can also perform and rollback migrations<span class="token punctuation">.</span> Command line documentation is unfortunately thin and <span class="token keyword">in</span> <span class="token keyword">this</span> course we decided to <span class="token keyword">do</span> both models and migrations manually<span class="token punctuation">.</span> The decision may or may not have been a wise one<span class="token punctuation">.</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;tasks&quot;</span><span class="token operator">&gt;</span>

### Task <span class="token number">13.24</span><span class="token punctuation">.</span>

#### Task <span class="token number">13.24</span><span class="token punctuation">.</span>

Grande finale<span class="token operator">:</span> <span class="token punctuation">[</span>towards the end <span class="token keyword">of</span> part <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">/</span>part4<span class="token operator">/</span>token_based_login#token_based_login_problems<span class="token punctuation">)</span> there was mention <span class="token keyword">of</span> a token<span class="token operator">-</span>criticality problem<span class="token operator">:</span> <span class="token keyword">if</span> a user&#x27;s access to the system is decided to be revoked<span class="token punctuation">,</span> the user can still use the token he or she holds to access the system<span class="token punctuation">.</span> 

The usual solution to <span class="token keyword">this</span> is to store a record <span class="token keyword">of</span> each token issued to a customer <span class="token keyword">in</span> the backend database<span class="token punctuation">,</span> and check <span class="token keyword">with</span> each request whether the access is still valid<span class="token punctuation">.</span> In <span class="token keyword">this</span> <span class="token keyword">case</span><span class="token punctuation">,</span> the validity <span class="token keyword">of</span> the token can be removed immediately <span class="token keyword">if</span> necessary<span class="token punctuation">.</span> This solution is often called a <span class="token operator">&lt;</span>i<span class="token operator">&gt;</span>server<span class="token operator">-</span>side session<span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span><span class="token punctuation">.</span>

Extend the system now so that a user who has lost access cannot perform any action requiring logon<span class="token punctuation">.</span> 

You will probably need at least the following
<span class="token operator">-</span> a boolean value column <span class="token keyword">in</span> the user table to indicate whether the <span class="token constant">ID</span> is disabled 
  <span class="token operator">-</span> it is sufficient to disable and unenable IDs directly <span class="token keyword">from</span> the database
<span class="token operator">-</span> a table that remembers active sessions
  <span class="token operator">-</span> the session is stored <span class="token keyword">in</span> the table when the user logs <span class="token keyword">in</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> when the <span class="token constant">POST</span> <span class="token operator">/</span>api<span class="token operator">/</span>login operation is performed
  <span class="token operator">-</span> the <span class="token function">existence</span> <span class="token punctuation">(</span>and validity<span class="token punctuation">)</span> <span class="token keyword">of</span> the session is checked each time the user performs an operation requiring logon
<span class="token operator">-</span> a path that allows the user to <span class="token string">&quot;log out&quot;</span> <span class="token keyword">of</span> the system<span class="token punctuation">,</span> i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> <span class="token keyword">in</span> practice to <span class="token keyword">delete</span> active sessions <span class="token keyword">from</span> the database<span class="token punctuation">,</span> e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token constant">DELETE</span> <span class="token operator">/</span>api<span class="token operator">/</span>logout

Note that logging out should not be possible <span class="token keyword">with</span> an <span class="token string">&quot;expired token&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> the same token after logging out<span class="token punctuation">.</span>

You may also want to use a purpose<span class="token operator">-</span>built npm library to handle sessions<span class="token punctuation">.</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code></pre></div></div></div></div></div><div class="container spacing element--flex element--centered"><a class="edit-link" target="__BLANK" href="https://github.com/fullstack-hy2020/fullstack-hy2020.github.io/edit/source/src/content/13/en/part13c.md"><span>Propose changes to material</span></a></div><div class="container spacing spacing--after-large prev-next__container "><a class="col-4--mobile push-right-1 prev" href="/en/part13/join_tables_and_queries"><div class=" element--flex element--column"><p>Part<!-- --> <!-- -->13b</p><b>Previous part</b></div></a><div class="push-left-1 "></div></div></div><div class="container spacing--after-small spacing--mobile element--flex" id="footer"><div class="col-5 push-right-3 col-10--mobile order-2--mobile order-2--tablet footer__links element--flex element--space-between"><a href="https://www.helsinki.fi/" class="col-5 col-4--mobile spacing--mobile"><div class="image col-6 image--contain"><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/uoh_centre-3689cf9983a2ebc8089c8f078a9c4769.svg" alt="Helsingin yliopiston logo"/></div></div></a><a href="https://www.houston-inc.com/" class="col-5 col-4--mobile spacing--mobile"><div class="image col-6 image--contain"><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjQ3cHgiIGhlaWdodD0iODJweCIgdmlld0JveD0iMCAwIDI0NyA4MiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTMuMiAoNzI2NDMpIC0gaHR0cHM6Ly9za2V0Y2hhcHAuY29tIC0tPgogICAgPHRpdGxlPmxvZ28vaG91c3RvbjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPgogICAgICAgIDxwb2x5Z29uIGlkPSJwYXRoLTEiIHBvaW50cz0iMCAwLjAyNjcxOTI2NzMgMTM4LjIwODE2NyAwLjAyNjcxOTI2NzMgMTM4LjIwODE2NyAzNi40NjU0MzgxIDAgMzYuNDY1NDM4MSI+PC9wb2x5Z29uPgogICAgPC9kZWZzPgogICAgPGcgaWQ9ImxvZ28vaG91c3RvbiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9ImhvdXN0b25fc2ltcGxlLmVwcy1jb3B5LTMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDU0LjU4MTg5MywgMjMuMjYzMDQwKSI+CiAgICAgICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIGZpbGw9IndoaXRlIj4KICAgICAgICAgICAgICAgIDx1c2UgeGxpbms6aHJlZj0iI3BhdGgtMSI+PC91c2U+CiAgICAgICAgICAgIDwvbWFzaz4KICAgICAgICAgICAgPGcgaWQ9IkNsaXAtMiI+PC9nPgogICAgICAgICAgICA8cGF0aCBkPSJNODIuODA1MTI5OCwxMy41MDY2NjAzIEw4Mi44MDUxMjk4LDI1LjUzNjU1MDkgTDg1Ljk5MzYyOSwyNS41MzY1NTA5IEw4NS45OTM2MjksMTMuNTA2NjYwMyBMOTAuNDA2NTQ5MywxMy41MDY2NjAzIEw5MC40MDY1NDkzLDEwLjQ0NTY3ODQgTDc4LjM3NTEwMzYsMTAuNDQ1Njc4NCBMNzguMzc1MTAzNiwxMy41MDY2NjAzIEw4Mi44MDUxMjk4LDEzLjUwNjY2MDMgWiBNOTYuNDkxMDQ5NSwxNy45NjM2ODg1IEM5Ni40OTEwNDk1LDIwLjU1OTU1NzIgOTguMzE3ODU1NywyMi43MDc5ODQyIDEwMC44ODYxNTcsMjIuNzA3OTg0MiBDMTAzLjQ1NDg4MiwyMi43MDc5ODQyIDEwNS4yNDcxOTQsMjAuNTk1NDY1NyAxMDUuMjQ3MTk0LDE4LjAxNzk3NTMgTDEwNS4yNDcxOTQsMTguMDAwMDIxMSBDMTA1LjI0NzE5NCwxNS40MDQyOTM3IDEwMy40MjA1MjksMTMuMjU1ODY2NyAxMDAuODUyMjI4LDEzLjI1NTg2NjcgQzk4LjI4MzUwMjMsMTMuMjU1ODY2NyA5Ni40OTEwNDk1LDE1LjM2ODM4NTMgOTYuNDkxMDQ5NSwxNy45NDU3MzQzIEw5Ni40OTEwNDk1LDE3Ljk2MzY4ODUgWiBNOTMuMTQ3MDQxMywxOC4wMTc5NzUzIEw5My4xNDcwNDEzLDE3Ljk4MjA2NjkgQzkzLjE0NzA0MTMsMTMuNjg1NDk1NiA5Ni40MDQ4MTI3LDEwLjE3NjkzMDYgMTAwLjg4NjE1NywxMC4xNzY5MzA2IEMxMDUuMzY3OTI1LDEwLjE3NjkzMDYgMTA4LjU5MTM0MywxMy42NDk3Mjg1IDEwOC41OTEzNDMsMTcuOTQ1NzM0MyBMMTA4LjU5MTM0MywxNy45NjM2ODg1IEMxMDguNTkxMzQzLDIyLjI2MDI1OTggMTA1LjMzMzU3MiwyNS43Njg4MjQ3IDEwMC44NTIyMjgsMjUuNzY4ODI0NyBDOTYuMzcwMzE4LDI1Ljc2ODgyNDcgOTMuMTQ3MDQxMywyMi4zMTQxMjI0IDkzLjE0NzA0MTMsMTguMDE3OTc1MyBMOTMuMTQ3MDQxMywxOC4wMTc5NzUzIFogTTcwLjQxMTkxMzcsMjIuNzk3MDQ4NSBDNjguNzU2ODc0MiwyMi43OTcwNDg1IDY3LjM3ODIxNjYsMjIuMDgxMjgzMSA2Ni4wNjg0MDcsMjAuOTcxNzk3NCBMNjQuMTcyMTg3MiwyMy4zMTY0NDg0IEM2NS45MTMxODA4LDI0LjkyNzk0NTQgNjguMTM2Njc2MiwyNS43MzMzNDA0IDcwLjM0MzA2NTYsMjUuNzMzMzQwNCBDNzMuNDgwMTA1NSwyNS43MzMzNDA0IDc1LjY2OTI0NzYsMjQuMDUwMTY4IDc1LjY2OTI0NzYsMjEuMDYxMDAzIEw3NS42NjkyNDc2LDIxLjAyNTA5NDUgQzc1LjcyMTEzMSwxOC4zOTM0NTg4IDc0LjA0ODU2MTUsMTcuMzAxNzg1OCA3MS4xMDExMDExLDE2LjQ5NTgyNTMgQzY4LjU4NDY4MzQsMTUuODMzOTIyNiA2Ny45NjM5MTk5LDE1LjUxMTMxMjIgNjcuOTYzOTE5OSwxNC41MDg5ODYyIEw2Ny45NjM5MTk5LDE0LjQ3MzA3NzggQzY3Ljk2MzkxOTksMTMuNzM4OTM0MSA2OC42MDIyMTM1LDEzLjE2NjY2MTEgNjkuODI1NjQ0OSwxMy4xNjY2NjExIEM3MS4wNDk2NDE4LDEzLjE2NjY2MTEgNzIuMzA3OTkyMSwxMy43MjA5Nzk5IDczLjYwMDgzNywxNC42NTIwNTQ1IEw3NS4yNTU1OTM4LDEyLjE0NTk1NjkgQzczLjc4OTk5MjUsMTAuOTEwNjUwMiA3MS45ODA3MTY0LDEwLjIzMDM2OTIgNjkuODYwNTYzNywxMC4yMzAzNjkyIEM2Ni44OTU3MTQ3LDEwLjIzMDM2OTIgNjQuNzc1NTYyLDEyLjAzODY1NTcgNjQuNzc1NTYyLDE0Ljc3NzU5MjYgTDY0Ljc3NTU2MiwxNC44MTMwNzY5IEM2NC43NzU1NjIsMTcuODAyNjY2MSA2Ni42NzEwNzQ5LDE4LjY0NDUzNSA2OS41ODQxODE5LDE5LjQzMjExNzMgQzcyLjAxNDY0NTYsMjAuMDc2NjMxMiA3Mi41MTQ2Nzc2LDIwLjUwNjI2MDEgNzIuNTE0Njc3NiwyMS4zNDc3MDQ5IEw3Mi41MTQ2Nzc2LDIxLjM4MzA0NzkgQzcyLjUxNDY3NzYsMjIuMjYwMjU5OCA3MS43MjIyODg4LDIyLjc5NzA0ODUgNzAuNDExOTEzNywyMi43OTcwNDg1IEw3MC40MTE5MTM3LDIyLjc5NzA0ODUgWiBNMzEuMzM2NDY5NywxNy45NjM2ODg1IEMzMS4zMzY0Njk3LDIwLjU1OTU1NzIgMzMuMTYzNywyMi43MDc5ODQyIDM1LjczMTg1OTksMjIuNzA3OTg0MiBDMzguMzAwMTYxMSwyMi43MDc5ODQyIDQwLjA5MjQ3MjYsMjAuNTk1NDY1NyA0MC4wOTI0NzI2LDE4LjAxNzk3NTMgTDQwLjA5MjQ3MjYsMTguMDAwMDIxMSBDNDAuMDkyNDcyNiwxNS40MDQyOTM3IDM4LjI2NTI0MjMsMTMuMjU1ODY2NyAzNS42OTY5NDEsMTMuMjU1ODY2NyBDMzMuMTI5MjA1MywxMy4yNTU4NjY3IDMxLjMzNjQ2OTcsMTUuMzY4Mzg1MyAzMS4zMzY0Njk3LDE3Ljk0NTczNDMgTDMxLjMzNjQ2OTcsMTcuOTYzNjg4NSBaIE0yOC4wMDk3MDg5LDE4LjAxNzk3NTMgTDI4LjAwOTcwODksMTcuOTgyMDY2OSBDMjguMDA5NzA4OSwxMy42ODU0OTU2IDMxLjI2NzQ4MDMsMTAuMTc2OTMwNiAzNS43NDg4MjQ1LDEwLjE3NjkzMDYgQzQwLjIzMDczNDIsMTAuMTc2OTMwNiA0My40MzYxOTgsMTMuNjQ5NzI4NSA0My40NTQwMTA5LDE3Ljk0NTczNDMgTDQzLjQ1NDAxMDksMTcuOTYzNjg4NSBDNDMuNDU0MDEwOSwyMi4yNjAyNTk4IDQwLjE5NjIzOTUsMjUuNzY4ODI0NyAzNS43MTQ4OTUzLDI1Ljc2ODgyNDcgQzMxLjIzMjU2MTUsMjUuNzY4ODI0NyAyOC4wMDk3MDg5LDIyLjMxNDEyMjQgMjguMDA5NzA4OSwxOC4wMTc5NzUzIEwyOC4wMDk3MDg5LDE4LjAxNzk3NTMgWiBNNTMuODMwNDE3MSwyNS43MzMzNDA0IEM1Ny43NDI4ODEyLDI1LjczMzM0MDQgNjAuMjA3ODM5NywyMy40OTU4NDkyIDYwLjIwNzgzOTcsMTguOTMwNjcxNSBMNjAuMjA3ODM5NywxMC40MjcxNTg3IEw1Ny4wMDE4MTAzLDEwLjQyNzE1ODcgTDU3LjAwMTgxMDMsMTkuMDczNzM5OCBDNTcuMDAxODEwMywyMS40NzI2Nzc2IDU1LjgxMjMwODEsMjIuNjkwMDMgNTMuODY0NzcwNCwyMi42OTAwMyBDNTEuOTE3Mzc0MSwyMi42OTAwMyA1MC43Mjc3MzA1LDIxLjQxODk1NjMgNTAuNzI3NzMwNSwxOC45NjY1OCBMNTAuNzI3NzMwNSwxMC40MjcxNTg3IEw0Ny41Mzg2NjU4LDEwLjQyNzE1ODcgTDQ3LjUzODY2NTgsMTkuMDM3ODMxMyBDNDcuNTM4NjY1OCwyMy40Nzc4OTUgNDkuOTE3OTUzLDI1LjczMzM0MDQgNTMuODMwNDE3MSwyNS43MzMzNDA0IEw1My44MzA0MTcxLDI1LjczMzM0MDQgWiBNMy4xNTQ1NywzMy4xOTgxOTQ4IEwxMzUuMDM2NjMyLDMzLjE5ODE5NDggTDEzNS4wMzY2MzIsMy4zMDI0NDQ4OCBMMy4xNTQ1NywzLjMwMjQ0NDg4IEwzLjE1NDU3LDMzLjE5ODE5NDggWiBNMCwzNi40NzM5MjA0IEwxMzguMjA4MTY3LDM2LjQ3MzkyMDQgTDEzOC4yMDgxNjcsMC4wMjY3MTkyNjczIEwwLDAuMDI2NzE5MjY3MyBMMCwzNi40NzM5MjA0IFogTTE0LjgyMzExNDMsMTkuNDg1NDE0NCBMMjAuNzE4NjAwNSwxOS40ODU0MTQ0IEwyMC43MTg2MDA1LDI1LjUzNjU1MDkgTDIzLjkwNzY2NTIsMjUuNTM2NTUwOSBMMjMuOTA3NjY1MiwxMC40NDU2Nzg0IEwyMC43MTg2MDA1LDEwLjQ0NTY3ODQgTDIwLjcxODYwMDUsMTYuNDA2MDU0MiBMMTQuODIzMTE0MywxNi40MDYwNTQyIEwxNC44MjMxMTQzLDEwLjQ0NTY3ODQgTDExLjYzNDc1NjUsMTAuNDQ1Njc4NCBMMTEuNjM0NzU2NSwyNS41MzY1NTA5IEwxNC44MjMxMTQzLDI1LjUzNjU1MDkgTDE0LjgyMzExNDMsMTkuNDg1NDE0NCBaIE0xMTUuODY0OTIyLDE1Ljk0MTUwNjUgTDEyMi44OTc2MDIsMjUuNTM2NTUwOSBMMTI1LjYyMDk4OCwyNS41MzY1NTA5IEwxMjUuNjIwOTg4LDEwLjQ0NTY3ODQgTDEyMi40NjY0MTgsMTAuNDQ1Njc4NCBMMTIyLjQ2NjQxOCwxOS43MzYyMDggTDExNS42NTgzNzcsMTAuNDQ1Njc4NCBMMTEyLjcxMDkxNywxMC40NDU2Nzg0IEwxMTIuNzEwOTE3LDI1LjUzNjU1MDkgTDExNS44NjQ5MjIsMjUuNTM2NTUwOSBMMTE1Ljg2NDkyMiwxNS45NDE1MDY1IEwxMTUuODY0OTIyLDE1Ljk0MTUwNjUgWiIgaWQ9IkZpbGwtMSIgZmlsbD0iIzAwMDEwNSIgbWFzaz0idXJsKCNtYXNrLTIpIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=" alt="Houston inc. logo"/></div></div></a></div><div class="col-5 col-5--mobile order-1--mobile order-1--tablet footer__navigation element--flex"><div class="footer__navigation-link-container"><a class="footer__navigation-link nav-item-hover" style="margin-left:4.5rem" href="/en/about">About course</a><a class="footer__navigation-link nav-item-hover" style="margin-left:4.5rem" href="/en/#course-contents">Course contents</a><a class="footer__navigation-link nav-item-hover" style="margin-left:4.5rem" href="/en/faq">FAQ</a><a class="footer__navigation-link nav-item-hover" style="margin-left:4.5rem" href="/en/companies">Partners</a><a class="footer__navigation-link nav-item-hover" style="margin-left:4.5rem" href="/en/challenge">Challenge</a></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-135975842-1', 'fullstackopen.com', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/en/part13/migrations_many_to_many_relationships";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-1d86594356fc279bc7bd.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f4fbc5442c0ed5fcadc4.js"],"component---src-pages-about-en-js":["/component---src-pages-about-en-js-332226cf4c51621ee681.js"],"component---src-pages-about-es-js":["/component---src-pages-about-es-js-a4dd07f0db1912658ad9.js"],"component---src-pages-about-js":["/component---src-pages-about-js-125bff17095673dac110.js"],"component---src-pages-about-zh-js":["/component---src-pages-about-zh-js-58afd9244a753e3db031.js"],"component---src-pages-challenge-en-js":["/component---src-pages-challenge-en-js-2878258dde31a4e8b215.js"],"component---src-pages-challenge-es-js":["/component---src-pages-challenge-es-js-1a6c89d4c79fed9ec3a0.js"],"component---src-pages-challenge-js":["/component---src-pages-challenge-js-6f2a50078718a804e2cc.js"],"component---src-pages-challenge-zh-js":["/component---src-pages-challenge-zh-js-0bb7cda0fa7f1437c4e8.js"],"component---src-pages-companies-en-js":["/component---src-pages-companies-en-js-17161da277d9d76ca65e.js"],"component---src-pages-companies-es-js":["/component---src-pages-companies-es-js-1365385e17786836948c.js"],"component---src-pages-companies-js":["/component---src-pages-companies-js-65e51caed2b3cbdbed1d.js"],"component---src-pages-companies-zh-js":["/component---src-pages-companies-zh-js-c1210353185f6e66db68.js"],"component---src-pages-faq-en-js":["/component---src-pages-faq-en-js-d9a3f4c9a444cd8c2cf4.js"],"component---src-pages-faq-es-js":["/component---src-pages-faq-es-js-15b2a2f6ddacda26aca1.js"],"component---src-pages-faq-js":["/component---src-pages-faq-js-e8a6db8e6270c9ed3c10.js"],"component---src-pages-faq-zh-js":["/component---src-pages-faq-zh-js-844c6ffcb6d2eac62bd9.js"],"component---src-pages-index-en-js":["/component---src-pages-index-en-js-a347a006f079d54370f6.js"],"component---src-pages-index-es-js":["/component---src-pages-index-es-js-31b82ae957f2b4234d47.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d3b3cf8562b6d041f3d0.js"],"component---src-pages-index-zh-js":["/component---src-pages-index-zh-js-87526ff6b692672eb8d8.js"],"component---src-pages-search-en-js":["/component---src-pages-search-en-js-1e81f46032fb7b0b7fa4.js"],"component---src-pages-search-js":["/component---src-pages-search-js-11cd81d1ec8ed9307c5c.js"],"component---src-pages-search-zh-js":["/component---src-pages-search-zh-js-e486d9ea86fb98602cbb.js"],"component---src-templates-content-template-js":["/component---src-templates-content-template-js-128130c8a3514bd9602a.js"],"component---src-templates-part-intro-template-js":["/component---src-templates-part-intro-template-js-cc0b09ff5a85d6740d27.js"]};/*]]>*/</script><script src="/webpack-runtime-cc90f1d82ce6ab0fdcd6.js" async=""></script><script src="/framework-8cb3270495e919798e3b.js" async=""></script><script src="/commons-e2b868f99a021228e0f0.js" async=""></script><script src="/30844a71ec80b1e82ad30323d06b914984ff6c2b-bfbd018b7380e158211d.js" async=""></script><script src="/5d7a54886b2742230021cc39eab839038eb7a677-7e0df6a64154312ad871.js" async=""></script><script src="/styles-89fd2ae28bdf06750a71.js" async=""></script><script src="/ff8e348e8d42e8d61f84312613c75c948ce81396-73e1478ec1d8afda6a11.js" async=""></script><script src="/component---src-templates-content-template-js-128130c8a3514bd9602a.js" async=""></script><script src="/app-1d86594356fc279bc7bd.js" async=""></script><script src="/e4b9374bcd292c90587e3ccf579324c3065ac22f-91cf5431cb3e1fc76518.js" async=""></script></body></html>